<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>What kind of a progger are you? (v0.1)</title>
    <style>
      body { 
        font-family: Arial, sans-serif; 
        margin: 20px; 
      }
      .question, .intro {
        margin-bottom: 15px;
      }
      .answer-btn, .start-btn { 
        display: block; 
        margin: 10px 0; 
        padding: 10px; 
        width: 200px; 
      }
    </style>
  </head>
  <body>
    <div id="content-container"></div>
    <script>
      // Define sub-questionnaires. Each sub-questionnaire has a title and an array of questions.
      const subQuestionnaires = [
        {
          title: "Harmonic Complexity section",
          questions: [
            {
              question: "How do you like exotic scales?",
              answers: { 
                "love them":   { next: 1, score: 20 },
                "like them":   { next: 1, score: 15 },
                "indifferent about them":   { next: 1, score: 10 },
                "dislike them":  { next: 1, score: 5 },
                "hate them": { next: 1, score: 0 }
              }
            },
            {
              question: "How do you like voice leading and contrapuntal works",
              answers: { 
                "Love 'em":   { next: 1, score: 20 },
                "like 'em":   { next: 1, score: 15 },
                "indifferent":   { next: 1, score: 10 },
                "nah":  { next: 1, score: 5 },
                "I have no idea what they mean": { next: 1, score: 0 }
              }
            },
            {
              question: "How do you like jazz chords?",
              answers: { 
                "spicy!":   { next: 1, score: 20 },
                "they sound cool":   { next: 1, score: 15 },
                "not necessary":   { next: 1, score: 10 },
                "they are tiring":  { next: 1, score: 5 },
                "I'm a swiftie.": { next: 1, score: 0 }
              }
            },
            {
              question: "How do you like borrowed chords?",
              answers: { 
                "ohh!":   { next: 1, score: 20 },
                "interesting":   { next: 1, score: 15 },
                "mid":   { next: 1, score: 10 },
                "i cannot grasp them":  { next: 1, score: 5 },
                "i lack basic neural functions": { next: 1, score: 0 }
              }
            },
            {
              question: "How do you like modulations?",
              answers: { 
                "makes my ass contract":   { next: 0, score: 20 },
                "they are refreshing":   { next: 0, score: 15 },
                "a whole step up, and let's goo!":   { next: 0, score: 10 },
                "what is it the early 00's?":  { next: 0, score: 5 },
                "I clean my ears with screwdrivers": { next: 0, score: 0 }
              }
            }
          ]
        },
        {
          title: "Sub-Questionnaire 2: Daily Habits",
          questions: [
            {
              question: "Do you enjoy exercising?",
              answers: { 
                "Yes": { next: 1, score: 10 }, 
                "No":  { next: 1, score: 3 }
              }
            },
            {
              question: "How often do you read books?",
              answers: { 
                "Daily":  { next: null, score: 10 },
                "Weekly": { next: null, score: 5 },
                "Rarely": { next: null, score: 2 }
              }
            }
          ]
        }
      ];

      // Tracking variables for questionnaires.
      let currentSubQuestionnaireIndex = 0; // current sub-questionnaire index
      let currentQuestionIndex = 0; // current question index for the sub-questionnaire
      let scores = subQuestionnaires.map(() => 0); // individual scores per sub-questionnaire

      // Function to display the introduction page.
      function displayIntroduction() {
        const container = document.getElementById('content-container');
        container.innerHTML = "";
      
        // Introduction content.
        const introEl = document.createElement('div');
        introEl.className = "intro";
        introEl.innerHTML = "<h1>Welcome to the Prog test!</h1><p>Prog is a weird phenomenon. Over the years prog meant different things to different people. To some it meant literally proggresive, innovative music; while for others, it meant the music that resembles the music of the foundingfathers of the genre. This test is made to provide a rigorous categorization of different prog sub-types by testing different sensibilites of the questionee in different sections. When you're ready, click the button below to start.</p>";
        container.appendChild(introEl);
      
        // Start button to begin the questionnaire.
        const startButton = document.createElement('button');
        startButton.className = "start-btn";
        startButton.textContent = "Start the Test";
        startButton.onclick = function() {
          // Begin by resetting tracking variables and displaying the first question.
          currentSubQuestionnaireIndex = 0;
          currentQuestionIndex = 0;
          scores = subQuestionnaires.map(() => 0);
          displayQuestion();
        };
        container.appendChild(startButton);
      }
      
      // Function to display the current question
      function displayQuestion() {
        const container = document.getElementById('content-container');
        container.innerHTML = "";
      
        // Check if we've completed all sub-questionnaires.
        if (currentSubQuestionnaireIndex >= subQuestionnaires.length) {
          displayResults();
          return;
        }
      
        const currentSub = subQuestionnaires[currentSubQuestionnaireIndex];
        const currentQuestion = currentSub.questions[currentQuestionIndex];
      
        // Display sub-questionnaire title.
        const titleEl = document.createElement('h2');
        titleEl.textContent = currentSub.title;
        container.appendChild(titleEl);
      
        // Display the question.
        const questionEl = document.createElement('div');
        questionEl.className = "question";
        questionEl.innerHTML = `<p>${currentQuestion.question}</p>`;
        container.appendChild(questionEl);
      
        // Create answer buttons.
        for (let answer in currentQuestion.answers) {
          const button = document.createElement('button');
          button.className = "answer-btn";
          button.textContent = answer;
          button.onclick = function() {
            // Update score for the current sub-questionnaire.
            scores[currentSubQuestionnaireIndex] += currentQuestion.answers[answer].score;
            let nextIndex = currentQuestion.answers[answer].next;
            if (nextIndex !== null && nextIndex !== undefined && nextIndex < currentSub.questions.length) {
              // Move to the next question.
              currentQuestionIndex = nextIndex;
              displayQuestion();
            } else {
              // End of sub-questionnaire; move to the next one.
              currentSubQuestionnaireIndex++;
              currentQuestionIndex = 0;
              displayQuestion();
            }
          };
          container.appendChild(button);
        }
      }
      
      // Function to display questionnaire results.
      function displayResults() {
        const container = document.getElementById('content-container');
        container.innerHTML = "<h2>Results</h2>";
        subQuestionnaires.forEach((subQ, index) => {
          const resultEl = document.createElement('p');
          resultEl.textContent = `${subQ.title}: ${scores[index]} points`;
          container.appendChild(resultEl);
        });
        container.innerHTML += "<p>Thank you for completing the questionnaires!</p>";
      }
      
      // Begin with the introduction page when the page loads.
      window.onload = displayIntroduction;
    </script>
  </body>
</html>
