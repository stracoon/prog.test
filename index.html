<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Multi Sub-Questionnaire with Introduction</title>
    <style>
      body { 
        font-family: Arial, sans-serif; 
        margin: 20px; 
      }
      .question, .intro {
        margin-bottom: 15px;
      }
      .answer-btn, .start-btn { 
        display: block; 
        margin: 10px 0; 
        padding: 10px; 
        width: 200px; 
      }
    </style>
  </head>
  <body>
    <div id="content-container"></div>
    <script>
      // Define sub-questionnaires. Each sub-questionnaire has a title and an array of questions.
      const subQuestionnaires = [
        {
          title: "Sub-Questionnaire 1: Personal Preferences",
          questions: [
            {
              question: "What is your favorite color?",
              answers: { 
                "Red":   { next: 1, score: 10 }, 
                "Blue":  { next: 1, score: 5 },
                "Green": { next: 1, score: 8 }
              }
            },
            {
              question: "What is your favorite fruit?",
              answers: { 
                "Apple":  { next: null, score: 7 },
                "Banana": { next: null, score: 9 },
                "Grapes": { next: null, score: 4 }
              }
            }
          ]
        },
        {
          title: "Sub-Questionnaire 2: Daily Habits",
          questions: [
            {
              question: "Do you enjoy exercising?",
              answers: { 
                "Yes": { next: 1, score: 10 }, 
                "No":  { next: 1, score: 3 }
              }
            },
            {
              question: "How often do you read books?",
              answers: { 
                "Daily":  { next: null, score: 10 },
                "Weekly": { next: null, score: 5 },
                "Rarely": { next: null, score: 2 }
              }
            }
          ]
        }
      ];

      // Tracking variables for questionnaires.
      let currentSubQuestionnaireIndex = 0; // current sub-questionnaire index
      let currentQuestionIndex = 0; // current question index for the sub-questionnaire
      let scores = subQuestionnaires.map(() => 0); // individual scores per sub-questionnaire

      // Function to display the introduction page.
      function displayIntroduction() {
        const container = document.getElementById('content-container');
        container.innerHTML = "";
      
        // Introduction content.
        const introEl = document.createElement('div');
        introEl.className = "intro";
        introEl.innerHTML = "<h1>Welcome to the Questionnaire!</h1><p>This introduction page explains what the questionnaire is about. When you're ready, click the button below to start.</p>";
        container.appendChild(introEl);
      
        // Start button to begin the questionnaire.
        const startButton = document.createElement('button');
        startButton.className = "start-btn";
        startButton.textContent = "Start Questionnaire";
        startButton.onclick = function() {
          // Begin by resetting tracking variables and displaying the first question.
          currentSubQuestionnaireIndex = 0;
          currentQuestionIndex = 0;
          scores = subQuestionnaires.map(() => 0);
          displayQuestion();
        };
        container.appendChild(startButton);
      }
      
      // Function to display the current question
      function displayQuestion() {
        const container = document.getElementById('content-container');
        container.innerHTML = "";
      
        // Check if we've completed all sub-questionnaires.
        if (currentSubQuestionnaireIndex >= subQuestionnaires.length) {
          displayResults();
          return;
        }
      
        const currentSub = subQuestionnaires[currentSubQuestionnaireIndex];
        const currentQuestion = currentSub.questions[currentQuestionIndex];
      
        // Display sub-questionnaire title.
        const titleEl = document.createElement('h2');
        titleEl.textContent = currentSub.title;
        container.appendChild(titleEl);
      
        // Display the question.
        const questionEl = document.createElement('div');
        questionEl.className = "question";
        questionEl.innerHTML = `<p>${currentQuestion.question}</p>`;
        container.appendChild(questionEl);
      
        // Create answer buttons.
        for (let answer in currentQuestion.answers) {
          const button = document.createElement('button');
          button.className = "answer-btn";
          button.textContent = answer;
          button.onclick = function() {
            // Update score for the current sub-questionnaire.
            scores[currentSubQuestionnaireIndex] += currentQuestion.answers[answer].score;
            let nextIndex = currentQuestion.answers[answer].next;
            if (nextIndex !== null && nextIndex !== undefined && nextIndex < currentSub.questions.length) {
              // Move to the next question.
              currentQuestionIndex = nextIndex;
              displayQuestion();
            } else {
              // End of sub-questionnaire; move to the next one.
              currentSubQuestionnaireIndex++;
              currentQuestionIndex = 0;
              displayQuestion();
            }
          };
          container.appendChild(button);
        }
      }
      
      // Function to display questionnaire results.
      function displayResults() {
        const container = document.getElementById('content-container');
        container.innerHTML = "<h2>Results</h2>";
        subQuestionnaires.forEach((subQ, index) => {
          const resultEl = document.createElement('p');
          resultEl.textContent = `${subQ.title}: ${scores[index]} points`;
          container.appendChild(resultEl);
        });
        container.innerHTML += "<p>Thank you for completing the questionnaires!</p>";
      }
      
      // Begin with the introduction page when the page loads.
      window.onload = displayIntroduction;
    </script>
  </body>
</html>
